<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<body>

  <header th:fragment="header"
    class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm">
    <div class="flex items-center justify-between px-4 py-3">

      <!-- Left Section: Hamburger + App Icon + App Name -->
      <div class="flex items-center space-x-3">
        <!-- Hamburger Menu -->
        <button id="sidebar-toggle"
          class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white focus:outline-none lg:hidden">
          <i class="fas fa-bars text-xl"></i>
        </button>

        <!-- App Icon -->
        <img th:src="@{/images/ChatKeep_icon_light.png}" alt="ChatKeep" class="h-8 w-8 dark:hidden">
        <img th:src="@{/images/ChatKeep_icon_dark.png}" alt="ChatKeep"
          class="h-8 w-8 hidden dark:block">

        <!-- App Name -->
        <h1 class="text-xl font-semibold text-primary-500 hidden sm:block">ChatKeep</h1>
      </div>

      <!-- Middle Section: Search Box -->
      <div class="flex-1 max-w-2xl mx-4 hidden md:block">
        <div class="relative">
          <input type="text" id="search-input" name="query"
            placeholder="Search notes by title, tags, or content..." hx:get="@{/fragments/search}"
            hx-trigger="keyup changed delay:500ms" hx-target="#notes-grid" hx-swap="innerHTML"
            class="w-full px-4 py-2 pr-24 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-400">

          <!-- Right side icons inside search box -->
          <div
            class="absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center space-x-1">
            <!-- Import Archive Button (Plus Icon) -->
            <button id="import-archive-btn" title="Import Archive Markdown"
              class="p-1.5 text-gray-500 hover:text-primary-500 dark:text-gray-400 dark:hover:text-primary-400 transition-colors">
              <i class="fas fa-plus text-lg"></i>
            </button>

            <!-- Separator -->
            <div class="h-6 w-px bg-gray-300 dark:bg-gray-600"></div>

            <!-- Copy Template Button -->
            <button id="copy-template-btn" title="Copy Archive Template"
              class="p-1.5 text-gray-500 hover:text-primary-500 dark:text-gray-400 dark:hover:text-primary-400 transition-colors">
              <i class="fas fa-copy text-lg"></i>
            </button>
          </div>
        </div>
      </div>

      <!-- Right Section: Refresh + View Toggle + Settings + User Avatar -->
      <div class="flex items-center space-x-2 md:space-x-3">

        <!-- Refresh Button -->
        <button id="refresh-btn" title="Refresh" hx:get="@{/fragments/chat-notes}"
          hx-target="#notes-grid" hx-swap="innerHTML"
          class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors">
          <i class="fas fa-sync-alt"></i>
        </button>

        <!-- View Toggle: Grid / List -->
        <div
          class="hidden sm:flex items-center space-x-1 bg-gray-100 dark:bg-gray-700 rounded-lg p-1">
          <button id="grid-view-btn" title="Grid View"
            hx:get="@{/fragments/chat-notes(view='masonry')}" hx-target="#notes-grid"
            hx-swap="innerHTML"
            class="p-2 rounded text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-600 transition-colors view-toggle active">
            <i class="fas fa-th"></i>
          </button>
          <button id="list-view-btn" title="List View"
            hx:get="@{/fragments/chat-notes(view='list')}" hx-target="#notes-grid"
            hx-swap="innerHTML"
            class="p-2 rounded text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-gray-600 transition-colors view-toggle">
            <i class="fas fa-list"></i>
          </button>
        </div>

        <!-- Settings Button -->
        <div class="relative">
          <button id="settings-btn" title="Settings"
            class="p-2 text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors">
            <i class="fas fa-cog"></i>
          </button>

          <!-- Settings Dropdown -->
          <div id="settings-dropdown"
            class="hidden absolute right-0 mt-2 w-56 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50">
            <div class="py-2">
              <div
                class="px-4 py-2 text-sm font-semibold text-gray-700 dark:text-gray-300 border-b border-gray-200 dark:border-gray-700">
                Theme
              </div>
              <button data-theme="light"
                class="theme-option w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                <i class="fas fa-sun w-5"></i>
                <span>Light</span>
              </button>
              <button data-theme="dark"
                class="theme-option w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                <i class="fas fa-moon w-5"></i>
                <span>Dark</span>
              </button>
              <button data-theme="auto"
                class="theme-option w-full px-4 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                <i class="fas fa-circle-half-stroke w-5"></i>
                <span>Auto</span>
              </button>
            </div>
          </div>
        </div>

        <!-- User Avatar / Login -->
        <div class="relative">
          <button id="user-menu-btn" title="Account"
            class="p-1 rounded-full border-2 border-primary-400 hover:border-primary-500 transition-colors">
            <!-- Authenticated User Avatar -->
            <div id="user-avatar"
              class="hidden h-8 w-8 rounded-full bg-primary-500 text-white flex items-center justify-center text-sm font-semibold">
              <span id="user-initials">U</span>
            </div>
            <!-- Anonymous User Icon -->
            <div id="anonymous-icon"
              class="h-8 w-8 rounded-full bg-gray-300 dark:bg-gray-600 flex items-center justify-center">
              <i class="fas fa-user text-gray-600 dark:text-gray-300"></i>
            </div>
          </button>

          <!-- User Dropdown -->
          <div id="user-dropdown"
            class="hidden absolute right-0 mt-2 w-64 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-lg z-50">

            <!-- Authenticated User Info -->
            <div id="authenticated-user-menu" class="hidden">
              <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-700">
                <p class="text-sm font-semibold text-gray-900 dark:text-gray-100" id="user-email">
                  user@example.com</p>
                <p class="text-xs text-gray-500 dark:text-gray-400" id="user-username">@username</p>
              </div>
              <div class="py-2">
                <button id="logout-btn"
                  class="w-full px-4 py-2 text-left text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                  <i class="fas fa-sign-out-alt w-5"></i>
                  <span>Log Out</span>
                </button>
              </div>
            </div>

            <!-- Anonymous User Login -->
            <div id="anonymous-user-menu" class="py-2">
              <p class="px-4 py-2 text-sm text-gray-500 dark:text-gray-400">
                Log in to sync across devices
              </p>
              <a href="/login"
                class="block px-4 py-2 text-sm text-primary-600 dark:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-700 flex items-center space-x-2">
                <i class="fas fa-sign-in-alt w-5"></i>
                <span>Log In with OAuth2</span>
              </a>
            </div>

          </div>
        </div>

      </div>

    </div>

    <!-- Mobile Search Bar (hidden on desktop) -->
    <div class="md:hidden px-4 pb-3">
      <div class="relative">
        <input type="text" id="mobile-search-input" name="query" placeholder="Search notes..."
          hx:get="@{/fragments/search}" hx-trigger="keyup changed delay:500ms"
          hx-target="#notes-grid" hx-swap="innerHTML"
          class="w-full px-4 py-2 pr-24 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-400">

        <div
          class="absolute right-2 top-1/2 transform -translate-y-1/2 flex items-center space-x-1">
          <button
            class="import-archive-btn p-1.5 text-gray-500 hover:text-primary-500 dark:text-gray-400 dark:hover:text-primary-400 transition-colors">
            <i class="fas fa-plus text-lg"></i>
          </button>
          <div class="h-6 w-px bg-gray-300 dark:bg-gray-600"></div>
          <button
            class="copy-template-btn p-1.5 text-gray-500 hover:text-primary-500 dark:text-gray-400 dark:hover:text-primary-400 transition-colors">
            <i class="fas fa-copy text-lg"></i>
          </button>
        </div>
      </div>
    </div>

  </header>

</body>

</html>